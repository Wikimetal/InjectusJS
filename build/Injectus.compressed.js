function Component(){this.LifeStyleType=this.Implementation=this.Interface=null}Component.From=function(a){var b=new Component;b.Interface=a;return b};Component.prototype.ImplementedBy=function(a){this.Implementation=a;return this};Component.prototype.WithLifestyle=function(a){this.LifeStyleType=a;return this};
Array.prototype.ForEach=function(a){var b=[],c=!1;for(element in this)if(b[element]||(c=a(this[element])),c)break};Function.prototype.Name=function(){var a=this.name;return a?a:(a=this.toString().match(/^function ([^(]+)/))&&2<=a.length?a[1]:null};Object.create||(Object.create=function(){function a(){}return function(b){if(1!=arguments.length)throw Error("Object.create implementation only accepts one parameter.");a.prototype=b;return new a}}());
function InjectusMetrics(){this.Registered=[];this.TotalRegistered=0;this.Resolved=[];this.TotalResolved=0}InjectusMetrics.prototype.Register=function(a){this.Registered[a.Interface.Name()]||(this.TotalRegistered++,this.Registered[this.Registered.length]=a)};InjectusMetrics.prototype.Resolve=function(a){this.TotalResolved++;a=a.Interface.Name();this.Resolved[a]||(this.Resolved[a]={Interface:a,Total:0});this.Resolved[a].Total++};
InjectusMetrics.prototype.PrintLog=function(){window.console&&console.log&&(console.log("------------------------------------------------------------------------------------------------"),console.log("|                                      INJECTUS REPORT                                         |"),console.log("------------------------------------------------------------------------------------------------"),console.log(" -> Registered components: "+this.TotalRegistered),this.Registered.ForEach(function(a){console.log("      -Interface: "+
a.Interface.Name()+" implemented by "+a.Implementation.Name())}),console.log(" -> Resolved components:"+this.TotalResolved),this.Resolved.ForEach(function(a){console.log("      -Interface: "+a.Interface+" resolved "+a.Total)}),console.log("------------------------------------------------------------------------------------------------"),console.log(" "))};
function LifeStyleType(){}LifeStyleType.Singleton="singleton";LifeStyleType.Transient="transient";
function Injectus(){this.Components=[];this.SingletonComponents=[];this.SingletonInstances=[];this.Metrics=new InjectusMetrics}Injectus.MaxAllowedDependecies=5;Injectus.instance=null;Injectus.getInstance=function(){Injectus.instance||(Injectus.instance=new Injectus);return Injectus.instance};Injectus.SetMaxDependenciesNumber=function(a){a>Injectus.MaxAllowedDependecies&&(Injectus.MaxAllowedDependecies=a)};Injectus.GetMetrics=function(){return Injectus.getInstance().Metrics};
Injectus.Register=function(a){if(!a||!a.Interface||!a.Interface.Name()||!a.Implementation.Name())throw"Invalid component to register. Reason: null component or Interface property not initialized";var b=a.Interface.Name(),c=Injectus.getInstance();if(c.Components[b])throw"Component "+b+" already registered";c.Components[b]=a;c.Metrics.Register(a);if(a.Implementation.Dependencies&&a.Implementation.Dependencies.length>Injectus.MaxAllowedDependecies)throw"Injectus: Object "+a.Implementation.Name()+" has too much dependencies";
};
Injectus.Resolve=function(a){if(!a||!a.Name())throw"Invalid component to resolve";a=a.Name();var b=Injectus.getInstance();if(!b.Components[a])throw"No component registered for interface "+a;if(b.SingletonInstances[a])return b.SingletonInstances[a];b.Metrics.Resolve(b.Components[a]);var c=b.Components[a].Implementation.Name(),d="new "+c+"(",c=eval(c),e=!1;c.Dependencies&&c.Dependencies.ForEach(function(a){e=!0;if(!b.Components[a])throw"Trying to resolve a non Registered dependency: "+a;d+="Injectus.Resolve("+a+
"),"});e&&(d=d.slice(0,-1));d+=")";return b.Components[a].LifeStyleType==LifeStyleType.Singleton?(b.SingletonInstances[a]=eval(d),b.SingletonInstances[a]):eval(d)};